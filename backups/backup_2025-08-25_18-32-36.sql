-- Database: glass_inventory Backup
-- Date: 2025-08-25 18:32:36
-- Generated by Glass Inventory Management System

SET FOREIGN_KEY_CHECKS=0;

DROP TABLE IF EXISTS `bases`;
CREATE TABLE `bases` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '基地名称',
  `code` varchar(20) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '基地编码',
  `address` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '基地地址',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='基地信息表';

INSERT INTO `bases` VALUES ('1','信义基地','XY','德阳信义工业园区8号厂房','2025-08-13 13:09:51','2025-08-13 13:09:51'),('2','新丰基地','XF','台北路西三段10号良木道集团1车间','2025-08-13 13:12:12','2025-08-13 13:12:12'),('3','金鱼基地','JY','广汉市飞宇路11号','2025-08-13 13:12:57','2025-08-13 13:12:57');

DROP TABLE IF EXISTS `daily_operation_summary`;
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `daily_operation_summary` AS select `ior`.`base_id` AS `base_id`,`b`.`name` AS `base_name`,`ior`.`operation_date` AS `operation_date`,`ior`.`operation_type` AS `operation_type`,count(0) AS `record_count`,sum(`ior`.`operation_quantity`) AS `total_quantity`,sum(`ior`.`total_area`) AS `total_area`,count(distinct `ior`.`package_id`) AS `package_count`,count(distinct `ior`.`glass_type_id`) AS `glass_type_count` from (`inventory_operation_records` `ior` left join `bases` `b` on((`ior`.`base_id` = `b`.`id`))) where (`ior`.`status` = 'completed') group by `ior`.`base_id`,`ior`.`operation_date`,`ior`.`operation_type` order by `ior`.`operation_date` desc,`ior`.`base_id`,`ior`.`operation_type`;


DROP TABLE IF EXISTS `dictionary_items`;
CREATE TABLE `dictionary_items` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `category` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '分类（brand/manufacturer/color）',
  `code` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '代码',
  `name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '名称',
  `parent_id` int(11) DEFAULT NULL COMMENT '父级ID（用于品牌-生产商关系）',
  `sort_order` int(11) DEFAULT '0' COMMENT '排序',
  `status` tinyint(1) DEFAULT '1' COMMENT '状态：1启用，0禁用',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_category_code` (`category`,`code`) USING BTREE,
  KEY `idx_category` (`category`) USING BTREE,
  KEY `idx_parent_id` (`parent_id`) USING BTREE
) ENGINE=MyISAM AUTO_INCREMENT=23 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='数据字典表（支持层级关系）';

INSERT INTO `dictionary_items` VALUES ('1','brand','xinyi','信义',NULL,'1','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('2','brand','taibo','台玻',NULL,'2','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('3','brand','jinjing','金晶',NULL,'3','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('4','brand','qibin','旗滨',NULL,'4','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('5','manufacturer','cq_xinyi','重庆信义','1','1','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('6','manufacturer','dy_xinyi','德阳信义','1','2','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('7','manufacturer','tj_xinyi','天津信义','1','3','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('8','manufacturer','wh_xinyi','芜湖信义','1','4','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('9','manufacturer','cd_taibo','成都台玻','2','1','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('10','manufacturer','cq_taibo','重庆台玻','2','2','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('11','manufacturer','zb_jinjing','淄博金晶','3','1','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('12','manufacturer','mz_jinjing','马鞍山金晶','3','2','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('13','manufacturer','sz_qibin','绍兴旗滨','4','1','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('14','manufacturer','cz_qibin','郴州旗滨','4','2','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('15','color','white','白玻',NULL,'1','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('16','color','yusha','玉沙',NULL,'2','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('17','color','lowe','LOWE',NULL,'3','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('18','color','ultra_white','超白',NULL,'4','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('19','color','coated','镀膜',NULL,'5','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('20','color','colored','色玻',NULL,'6','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('21','color','one_way','单向透视',NULL,'7','1','2025-08-13 14:24:07','2025-08-13 14:24:07'),('22','color','changlong','长虹',NULL,'8','1','2025-08-13 14:24:07','2025-08-13 14:24:07');

DROP TABLE IF EXISTS `glass_packages`;
CREATE TABLE `glass_packages` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `package_code` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '包号/二维码',
  `glass_type_id` int(11) NOT NULL COMMENT '原片类型ID',
  `width` decimal(10,2) DEFAULT NULL COMMENT '宽度(mm)',
  `height` decimal(10,2) DEFAULT NULL COMMENT '高度(mm)',
  `pieces` int(11) NOT NULL DEFAULT '0' COMMENT '实际片数（库存操作基准）',
  `quantity` int(11) NOT NULL DEFAULT '0' COMMENT '默认包装数量（参考值）',
  `entry_date` date DEFAULT NULL COMMENT '入库日期',
  `initial_rack_id` int(11) DEFAULT NULL COMMENT '起始库区ID',
  `current_rack_id` int(11) DEFAULT NULL COMMENT '当前库位架ID',
  `position_order` int(11) DEFAULT '1' COMMENT '在架中的位置顺序(1-x)',
  `status` enum('in_storage','in_processing','scrapped','used_up') COLLATE utf8mb4_unicode_ci DEFAULT 'in_storage' COMMENT '包状态：in_storage=库存中，in_processing=加工中，scrapped=已报废，used_up=已用完',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `glass_type_id` (`glass_type_id`),
  KEY `current_rack_id` (`current_rack_id`),
  KEY `initial_rack_id` (`initial_rack_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='原片包信息表';


DROP TABLE IF EXISTS `glass_types`;
CREATE TABLE `glass_types` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `custom_id` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '原片ID（自定义，唯一，采购使用）',
  `name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '原片名称（完整名称）',
  `short_name` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '原片简称（如：5白、4白、5白南玻）',
  `finance_name` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '财务核算名',
  `product_series` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '原片商色系（如：5lowe XETB0160）',
  `brand` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '原片品牌（如：信义、台玻、金晶、旗滨）',
  `manufacturer` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '原片生产商（如：重庆信义、德阳信义、成都台玻）',
  `color` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '原片颜色（如：白玻、玉沙、LOWE、超白等）',
  `thickness` decimal(10,2) DEFAULT NULL COMMENT '原片厚度(mm)（如：4、5、6、8、10、12、15、19）',
  `width` decimal(10,2) DEFAULT NULL COMMENT '宽度(mm)',
  `height` decimal(10,2) DEFAULT NULL COMMENT '高度(mm)',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT '备注描述',
  `status` tinyint(1) DEFAULT '1' COMMENT '状态：1启用，0禁用',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `custom_id` (`custom_id`),
  KEY `idx_custom_id` (`custom_id`),
  KEY `idx_short_name` (`short_name`),
  KEY `idx_brand` (`brand`),
  KEY `idx_manufacturer` (`manufacturer`),
  KEY `idx_color` (`color`)
) ENGINE=MyISAM AUTO_INCREMENT=82 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='原片基础信息表';

INSERT INTO `glass_types` VALUES ('1','XY5C','5mm白玻信义','5白','5白','XYC','信义','德阳信义','白玻','5.00',NULL,NULL,NULL,'1','2025-08-13 14:46:41','2025-08-17 18:27:31'),('2','5mmXETB0160','5mmLowe XETB0160','5L60','5L','XETB0160','信义','德阳信义','LOWE','5.00',NULL,NULL,NULL,'1','2025-08-13 14:48:03','2025-08-13 14:48:03'),('3','TG5C','5mm白玻台玻','5白台玻','5白','TGC','台玻','成都台玻','白玻','5.00',NULL,NULL,NULL,'1','2025-08-13 14:50:14','2025-08-17 18:27:46'),('4','12XETB0160','12mmXETB0160','12LOWE','12L','XETB0160','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-13 14:57:57','2025-08-13 14:57:57'),('5','10SUPER3','10mmsuper3','10S3','10S3','SUPER3','南玻','成都南玻','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('6','10SUPERC1','10mmSUPER-C1','10C1','10C1','SUPER-C1','南玻','成都南玻','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('7','10TD178','10mmTD178','10TD178','10L78','TD178','南玻','成都南玻','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('8','10XDTB0061','10mmXDTB0061','10XDTB0061','10L双银','XDTB0061','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('9','10XDTB0161','10mmXDTB0161','10XDTB0161','10L双银','XDTB0161','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('10','10XDTN0082','10mmXDTN0082','10XDTN0082','10L80双银','XDTN0082','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('11','10XDTN0182','10mmXDTN0182','10XDTN0182','10L80双银','XDTN0182','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('12','10XETB0060','10mmXETB0060','10XETB0060','10L','XETB0060','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('13','10XETB0140','10mmXETB0140','10XETB0140','10L40','XETB0140','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('14','10XETB0160','10mmXETB0160','10XETB0160','10L','XETB0160','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('15','10XETB0180','10mmXETB0180','10XETB0180','10L80','XETB0180','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('16','10XETG0140','10mmXETG0140','10XETG0140','10L40','XETG0140','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('17','10XETN0080','10mmXETN0080','10XETN0080','10L80','XETN0080','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('18','10XETN0180','10mmXETN0180','10XETN0180','10L80','XETN0180','信义','德阳信义','LOWE','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('19','10CSG','10mm南玻白玻','10白南玻','10白','SGC','南玻','成都南玻','白玻','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('20','10SCSG','10mm南玻超白玻','10超白南玻','10超白','SCSG','南玻','成都南玻','超白','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('21','10CXY','10mm信义白玻','10白','10白','XYC','信义','德阳信义','白玻','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('22','10SCXY','10mm信义超白玻','10超白','10超白','SCXY','信义','德阳信义','超白','10.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('23','12SUPER3','12mmSUPER3','12S3','12S3','SUPER3','南玻','成都南玻','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('24','12SUPERC1','12mmSUPER-C1','12C1','12C1','SUPER-C1','南玻','成都南玻','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('25','12TD178','12mmTD178','12TD178','12L78','TD178','南玻','成都南玻','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('26','12XDTB0061','12mmXDTB0061','12XDTB0061','12L双银','XDTB0061','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('27','12XDTB0161','12mmXDTB0161','12XDTB0161','12L双银','XDTB0161','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('28','12XDTN0082','12mmXDTN0082','12XDTN0082','12L80双银','XDTN0082','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('29','12XETB0060','12mmXETB0060','12XETB0060','12L','XETB0060','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('30','12XETB0180','12mmXETB0180','12XETB0180','12L80','XETB0180','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('31','12XETN0080','12mmXETN0080','12XETN0080','12L80','XETN0080','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('32','12XETN0180','12mmXETN0180','12XETN0180','12L80','XETN0180','信义','德阳信义','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('33','12XSTB0160','12mmXSTB0160','12XSTB0160','12热反射','XSTB0160','信义','德阳信义','镀膜','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('34','12CS3','12mm超白SUPER3','12超白S3','12超白S3','CSUPER3','南玻','成都南玻','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('35','12CSC1','12mm超白SUPER-C1','12超白C1','12超白C1','CSUPER-C1','南玻','成都南玻','LOWE','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('36','12CSG','12mm南玻白玻','12白南玻','12白','SGC','南玻','成都南玻','白玻','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('37','12SCSG','12mm南玻超白玻','12超白南玻','12超白','SCSG','南玻','成都南玻','超白','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('38','12CXY','12mm信义白玻','12白','12白','XYC','信义','德阳信义','白玻','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('39','12SCXY','12mm信义超白玻','12超白','12超白','SCXY','信义','德阳信义','超白','12.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('40','15XDTB0061','15mmXDTB0061','15XDTB0061','15L双银','XDTB0061','信义','德阳信义','LOWE','15.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('41','15SCXY','15mm信义超白','15超白','15超白','SCXY','信义','德阳信义','超白','15.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('42','5CTG','5mm白玻台玻','5白台玻','5白','TGC','台玻','成都台玻','白玻','5.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('43','5CXY','5mm白玻信义','5白','5白','XYC','信义','德阳信义','白玻','5.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('44','6SUPERC1','6mmSUPER-C1','6C1','6L','SUPER-C1','南玻','成都南玻','LOWE','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('45','6XETB0060','6mmXETB0060','6XETB0060','6L','XETB0060','信义','德阳信义','LOWE','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('46','6XETB0160','6mmXETB0160','6XETB0160','6L','XETB0160','信义','德阳信义','LOWE','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('47','6XETN0180','6mmXETN0180','6XETN0180','6L80','XETN0180','信义','德阳信义','LOWE','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('48','6CSG','6mm南玻白玻','6白南玻','6白','SGC','南玻','成都南玻','白玻','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('49','6SCSG','6mm南玻超白玻','6超白南玻','6超白','SCSG','南玻','成都南玻','超白','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('50','6CXY','6mm信义白玻','6白','6白','XYC','信义','德阳信义','白玻','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('51','6SCXY','6mm信义超白玻','6超白','6超白','SCXY','信义','德阳信义','超白','6.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('52','8SUPER3','8mmSUPER3','8S3','8S3','SUPER3','南玻','成都南玻','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('53','8SUPERC1','8mmSUPER-C1','8C1','8C1','SUPER-C1','南玻','成都南玻','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('54','8TD178','8mmTD178','8TD178','8L78','TD178','南玻','成都南玻','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('55','8XDTB0061','8mmXDTB0061','8XDTB0061','8L双银','XDTB0061','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('56','8XDTB0161','8mmXDTB0161','8XDTB0161','8L双银','XDTB0161','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('57','8XDTG0156','8mmXDTG0156','8XDTG0156','8L双银','XDTG0156','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('58','8XDTN0082','8mmXDTN0082','8XDTN0082','8L80双银','XDTN0082','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('59','8XDTN0182','8mmXDTN0182','8XDTN0182','8L80双银','XDTN0182','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('60','8XETB0060','8mmXETB0060','8XETB0060','8L','XETB0060','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('61','8XETB0160','8mmXETB0160','8XETB0160','8L','XETB0160','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('62','8XETB0180','8mmXETB0180','8XETB0180','8L80','XETB0180','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('63','8XETN0080','8mmXETN0080','8XETN0080','8L80','XETN0080','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('64','8XETN0180','8mmXETN0180','8XETN0180','8L80','XETN0180','信义','德阳信义','LOWE','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('65','8CSG','8mm南玻白玻','8白南玻','8白','SGC','南玻','成都南玻','白玻','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('66','8SCSG','8mm南玻超白玻','8超白南玻','8超白','SCSG','南玻','成都南玻','超白','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('67','8CXY','8mm信义白玻','8白','8白','XYC','信义','德阳信义','白玻','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('68','8SCXY','8mm信义超白玻','8超白','8超白','SCXY','信义','德阳信义','超白','8.00',NULL,NULL,NULL,'1','2025-08-18 20:06:16','2025-08-18 20:06:16'),('69','5XETB0160','5mmXETB0160','5L60','5L','XETB0160','信义','德阳信义','LOWE','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('70','4CTG','4mm台玻白玻','4白','4白','CTG','台玻','成都台玻','白玻','4.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('71','4YSTG','4mm台玻玉砂','4玉','4玉','YSTG','台玻','成都台玻','玉砂','4.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('72','5CSG','5mm白玻南玻','5白南玻','5白','CSG','南玻','成都南玻','白玻','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('73','5YSTG','5mm玉砂台玻','5玉台玻','5玉','YSTG','台玻','成都台玻','玉砂','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('74','6YSTG','6mm玉砂台玻','6玉台玻','6玉','YSTG','台玻','成都台玻','玉砂','6.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('75','5XETB0060','5mmXETB0060','5超白LOWE','5L','XETB0060','信义','德阳信义','LOWE','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('76','5XDTG0156','5mmXDTG0156','5XDTG0156','5L双银','XDTG0156','信义','德阳信义','LOWE','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('77','5SUPER3','5mmSUPER3','5S3','5L','SUPER3','南玻','成都南玻','LOWE','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('78','5TD160','5mmTD160','5TD160','5L','TD160','南玻','成都南玻','LOWE','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('79','5TD178','5mmTD178','5TD178','5L','TD178','南玻','成都南玻','LOWE','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('80','5SCH','5mm超白长虹','5SCH','5超白长虹','超白长虹','南玻','成都南玻','长虹','5.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38'),('81','8SCH','8mm超白长虹','8SCH','8超白长虹','超白长虹','南玻','成都南玻','长虹','8.00',NULL,NULL,NULL,'1','2025-08-25 17:33:38','2025-08-25 17:33:38');

DROP TABLE IF EXISTS `inventory_operation_records`;
CREATE TABLE `inventory_operation_records` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `record_no` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '记录单号（自动生成）',
  `operation_type` enum('purchase_in','usage_out','partial_usage','return_in','scrap','check_in','check_out') COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '操作类型',
  `package_id` int(11) NOT NULL COMMENT '原片包ID',
  `glass_type_id` int(11) NOT NULL COMMENT '原片类型ID',
  `base_id` int(11) NOT NULL COMMENT '操作基地ID',
  `operation_quantity` int(11) NOT NULL COMMENT '操作数量',
  `before_quantity` int(11) NOT NULL COMMENT '操作前数量',
  `after_quantity` int(11) NOT NULL COMMENT '操作后数量',
  `from_rack_id` int(11) DEFAULT NULL COMMENT '来源库位架ID',
  `to_rack_id` int(11) DEFAULT NULL COMMENT '目标库位架ID',
  `unit_area` decimal(10,2) DEFAULT NULL COMMENT '单片面积（平方米）',
  `total_area` decimal(10,2) GENERATED ALWAYS AS ((`operation_quantity` * `unit_area`)) STORED COMMENT '操作总面积',
  `operator_id` int(11) NOT NULL COMMENT '操作员ID',
  `operation_date` date NOT NULL COMMENT '操作日期',
  `operation_time` time NOT NULL DEFAULT '08:00:00' COMMENT '操作时间',
  `status` enum('pending','completed','cancelled') COLLATE utf8mb4_unicode_ci DEFAULT 'completed' COMMENT '记录状态',
  `scrap_reason` text COLLATE utf8mb4_unicode_ci COMMENT '报废原因（报废操作必填）',
  `notes` text COLLATE utf8mb4_unicode_ci COMMENT '备注信息',
  `related_record_id` int(11) DEFAULT NULL COMMENT '关联记录ID（如归还时关联原领用记录）',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `record_no` (`record_no`),
  KEY `from_rack_id` (`from_rack_id`),
  KEY `to_rack_id` (`to_rack_id`),
  KEY `related_record_id` (`related_record_id`),
  KEY `idx_record_no` (`record_no`),
  KEY `idx_package_operation` (`package_id`,`operation_type`),
  KEY `idx_base_date` (`base_id`,`operation_date`),
  KEY `idx_operation_time` (`operation_date`,`operation_time`),
  KEY `idx_status` (`status`),
  KEY `idx_glass_type` (`glass_type_id`),
  KEY `idx_operator` (`operator_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='库存操作记录表';


DROP TABLE IF EXISTS `inventory_transactions`;
CREATE TABLE `inventory_transactions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `package_id` int(11) NOT NULL COMMENT '原片包ID',
  `transaction_type` enum('purchase_in','usage_out','return_in','scrap','partial_usage','location_adjust','check_in','check_out') COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '交易类型：采购入库、领用出库、归还入库、报废、部分领用、基地流转、盘盈入库、盘亏出库',
  `from_rack_id` int(11) DEFAULT NULL COMMENT '来源库位架ID',
  `to_rack_id` int(11) DEFAULT NULL COMMENT '目标库位架ID',
  `quantity` int(11) NOT NULL COMMENT '数量',
  `operator_id` int(11) DEFAULT NULL COMMENT '操作员ID',
  `scrap_reason` text COLLATE utf8mb4_unicode_ci COMMENT '报废原因',
  `transaction_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '交易时间',
  `actual_usage` int(11) DEFAULT '0' COMMENT '实际领用量',
  `notes` text COLLATE utf8mb4_unicode_ci COMMENT '备注信息',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `package_id` (`package_id`),
  KEY `from_rack_id` (`from_rack_id`),
  KEY `to_rack_id` (`to_rack_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='库存流转记录表';


DROP TABLE IF EXISTS `package_operation_history`;
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `package_operation_history` AS select `ior`.`id` AS `id`,`ior`.`record_no` AS `record_no`,`ior`.`operation_type` AS `operation_type`,`ior`.`package_id` AS `package_id`,`ior`.`glass_type_id` AS `glass_type_id`,`ior`.`base_id` AS `base_id`,`ior`.`operation_quantity` AS `operation_quantity`,`ior`.`before_quantity` AS `before_quantity`,`ior`.`after_quantity` AS `after_quantity`,`ior`.`from_rack_id` AS `from_rack_id`,`ior`.`to_rack_id` AS `to_rack_id`,`ior`.`unit_area` AS `unit_area`,`ior`.`total_area` AS `total_area`,`ior`.`operator_id` AS `operator_id`,`ior`.`operation_date` AS `operation_date`,`ior`.`operation_time` AS `operation_time`,`ior`.`status` AS `status`,`ior`.`scrap_reason` AS `scrap_reason`,`ior`.`notes` AS `notes`,`ior`.`related_record_id` AS `related_record_id`,`ior`.`created_at` AS `created_at`,`ior`.`updated_at` AS `updated_at`,`gp`.`package_code` AS `package_code`,`gt`.`name` AS `glass_name`,`gt`.`thickness` AS `thickness`,`gt`.`color` AS `color`,`gt`.`brand` AS `brand`,`b`.`name` AS `base_name`,`u`.`real_name` AS `operator_name`,`fr`.`code` AS `from_rack_code`,`tr`.`code` AS `to_rack_code` from ((((((`inventory_operation_records` `ior` left join `glass_packages` `gp` on((`ior`.`package_id` = `gp`.`id`))) left join `glass_types` `gt` on((`ior`.`glass_type_id` = `gt`.`id`))) left join `bases` `b` on((`ior`.`base_id` = `b`.`id`))) left join `users` `u` on((`ior`.`operator_id` = `u`.`id`))) left join `storage_racks` `fr` on((`ior`.`from_rack_id` = `fr`.`id`))) left join `storage_racks` `tr` on((`ior`.`to_rack_id` = `tr`.`id`))) order by `ior`.`operation_date` desc,`ior`.`operation_time` desc;


DROP TABLE IF EXISTS `settings`;
CREATE TABLE `settings` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `setting_key` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '设置键',
  `value` text COLLATE utf8mb4_unicode_ci COMMENT '设置值',
  `description` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '设置描述',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `setting_key` (`setting_key`)
) ENGINE=MyISAM AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统设置表';

INSERT INTO `settings` VALUES ('1','system_name','玻璃原片管理系统','系统名称','2025-08-13 13:39:38','2025-08-13 13:42:00'),('2','system_version','1.0.0','系统版本','2025-08-13 13:39:38','2025-08-13 13:39:38'),('3','maintenance_mode','0','维护模式：1开启，0关闭','2025-08-13 13:39:38','2025-08-17 16:44:46'),('4','session_timeout','30','会话超时时间（分钟）','2025-08-13 13:39:38','2025-08-13 13:39:38'),('5','backup_retention_days','30','备份文件保留天数','2025-08-13 13:39:38','2025-08-13 13:39:38'),('6','log_retention_days','90','日志保留天数','2025-08-13 13:39:38','2025-08-13 13:39:38');

DROP TABLE IF EXISTS `storage_racks`;
CREATE TABLE `storage_racks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `base_id` int(11) NOT NULL COMMENT '所属基地ID',
  `code` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '库位架编码',
  `name` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '库位架名称',
  `area_type` enum('storage','processing','scrap','temporary') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'storage' COMMENT '区域类型：库存区、加工区、报废区、临时区',
  `capacity` int(11) DEFAULT NULL COMMENT '容量',
  `status` enum('normal','maintenance','full') COLLATE utf8mb4_unicode_ci DEFAULT 'normal' COMMENT '状态：正常、维护中、已满',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `base_id` (`base_id`)
) ENGINE=MyISAM AUTO_INCREMENT=193 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='库位架信息表';

INSERT INTO `storage_racks` VALUES ('1','2','XF-B-废片架','废片架','scrap','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('2','3','JY-B-废片架','废片架','scrap','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('3','1','XY-B-废片架','废片架','scrap','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('4','2','XF-T-临时区','临时区','temporary','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('5','3','JY-T-临时区','临时区','temporary','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('6','1','XY-T-临时区','临时区','temporary','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('7','1','XY-P-A1','A1','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('8','1','XY-P-B1','B1','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('9','1','XY-P-A2','A2','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('10','1','XY-P-B2','B2','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('11','1','XY-N-1A','1A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('12','1','XY-N-2A','2A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('13','1','XY-N-3A','3A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('14','1','XY-N-4A','4A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('15','1','XY-N-5A','5A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('16','1','XY-N-6A','6A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('17','1','XY-N-7A','7A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('18','1','XY-N-8A','8A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('19','1','XY-N-9A','9A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('20','1','XY-N-10A','10A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('21','1','XY-N-11A','11A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('22','1','XY-N-12A','12A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('23','1','XY-N-13A','13A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('24','1','XY-N-14A','14A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('25','1','XY-N-15A','15A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('26','1','XY-N-16A','16A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('27','1','XY-N-17A','17A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('28','1','XY-N-18A','18A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('29','1','XY-N-19A','19A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('30','1','XY-N-20A','20A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('31','1','XY-N-21A','21A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('32','1','XY-N-22A','22A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('33','1','XY-N-23A','23A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('34','1','XY-N-24A','24A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('35','1','XY-N-25A','25A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('36','1','XY-N-26A','26A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('37','1','XY-N-27A','27A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('38','1','XY-N-28A','28A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('39','1','XY-N-29A','29A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('40','1','XY-N-30A','30A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('41','1','XY-N-31A','31A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('42','1','XY-N-32A','32A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('43','1','XY-N-33A','33A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('44','1','XY-N-34A','34A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('45','1','XY-N-35A','35A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('46','1','XY-N-36A','36A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('47','1','XY-N-37A','37A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('48','1','XY-N-38A','38A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('49','1','XY-N-39A','39A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('50','1','XY-N-40A','40A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('51','1','XY-N-41A','41A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('52','1','XY-N-42A','42A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('53','1','XY-N-43A','43A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('54','1','XY-N-44A','44A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('55','1','XY-N-45A','45A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('56','1','XY-N-46A','46A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('57','1','XY-N-47A','47A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('58','1','XY-N-48A','48A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('59','1','XY-N-49A','49A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('60','1','XY-N-50A','50A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('61','1','XY-N-51A','51A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('62','1','XY-N-52A','52A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('63','1','XY-N-53A','53A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('64','1','XY-N-54A','54A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('65','1','XY-N-55A','55A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('66','1','XY-N-56A','56A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('67','1','XY-N-57A','57A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('68','1','XY-N-58A','58A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('69','1','XY-N-59A','59A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('70','1','XY-N-60A','60A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('71','1','XY-N-1B','1B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('72','1','XY-N-2B','2B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('73','1','XY-N-3B','3B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('74','1','XY-N-4B','4B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('75','1','XY-N-5B','5B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('76','1','XY-N-6B','6B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('77','1','XY-N-7B','7B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('78','1','XY-N-8B','8B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('79','1','XY-N-9B','9B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('80','1','XY-N-10B','10B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('81','1','XY-N-11B','11B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('82','1','XY-N-12B','12B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('83','1','XY-N-13B','13B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('84','1','XY-N-14B','14B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('85','1','XY-N-15B','15B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('86','1','XY-N-16B','16B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('87','1','XY-N-17B','17B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('88','1','XY-N-18B','18B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('89','1','XY-N-19B','19B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('90','1','XY-N-20B','20B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('91','1','XY-N-21B','21B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('92','1','XY-N-22B','22B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('93','1','XY-N-23B','23B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('94','1','XY-N-24B','24B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('95','1','XY-N-25B','25B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('96','1','XY-N-26B','26B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('97','1','XY-N-27B','27B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('98','1','XY-N-28B','28B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('99','1','XY-N-29B','29B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('100','1','XY-N-30B','30B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38');
INSERT INTO `storage_racks` VALUES ('101','1','XY-N-31B','31B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('102','1','XY-N-32B','32B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('103','1','XY-N-33B','33B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('104','1','XY-N-34B','34B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('105','1','XY-N-35B','35B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('106','1','XY-N-36B','36B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('107','1','XY-N-37B','37B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('108','1','XY-N-38B','38B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('109','1','XY-N-39B','39B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('110','1','XY-N-40B','40B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('111','1','XY-N-41B','41B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('112','1','XY-N-42B','42B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('113','1','XY-N-43B','43B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('114','1','XY-N-44B','44B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('115','1','XY-N-45B','45B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('116','1','XY-N-46B','46B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('117','1','XY-N-47B','47B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('118','1','XY-N-48B','48B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('119','1','XY-N-49B','49B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('120','1','XY-N-50B','50B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('121','1','XY-N-51B','51B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('122','1','XY-N-52B','52B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('123','1','XY-N-53B','53B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('124','1','XY-N-54B','54B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('125','1','XY-N-55B','55B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('126','1','XY-N-56B','56B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('127','1','XY-N-57B','57B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('128','1','XY-N-58B','58B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('129','1','XY-N-59B','59B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('130','1','XY-N-60B','60B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('131','2','XF-P-A','A','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('132','2','XF-P-B','B','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('133','2','XF-P-1','1','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('134','2','XF-P-2','2','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('135','2','XF-P-3','3','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('136','2','XF-P-4','4','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('137','2','XF-N-5A','5A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('138','2','XF-N-6A','6A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('139','2','XF-N-7A','7A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('140','2','XF-N-8A','8A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('141','2','XF-N-9A','9A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('142','2','XF-N-10A','10A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('143','2','XF-N-11A','11A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('144','2','XF-N-12A','12A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('145','2','XF-N-13A','13A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('146','2','XF-N-14A','14A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('147','2','XF-N-15A','15A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('148','2','XF-N-16A','16A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('149','2','XF-N-17A','17A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('150','2','XF-N-18A','18A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('151','2','XF-N-19A','19A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('152','2','XF-N-20A','20A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('153','2','XF-N-21A','21A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('154','2','XF-N-22A','22A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('155','2','XF-N-23A','23A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('156','2','XF-N-24A','24A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('157','2','XF-N-25A','25A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('158','2','XF-N-26A','26A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('159','2','XF-N-27A','27A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('160','2','XF-N-28A','28A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('161','2','XF-N-29A','29A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('162','2','XF-N-30A','30A','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('163','2','XF-N-5B','5B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('164','2','XF-N-6B','6B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('165','2','XF-N-7B','7B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('166','2','XF-N-8B','8B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('167','2','XF-N-9B','9B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('168','2','XF-N-10B','10B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('169','2','XF-N-11B','11B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('170','2','XF-N-12B','12B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('171','2','XF-N-13B','13B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('172','2','XF-N-14B','14B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('173','2','XF-N-15B','15B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('174','2','XF-N-16B','16B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('175','2','XF-N-17B','17B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('176','2','XF-N-18B','18B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('177','2','XF-N-19B','19B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('178','2','XF-N-20B','20B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('179','2','XF-N-21B','21B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('180','2','XF-N-22B','22B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('181','2','XF-N-23B','23B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('182','2','XF-N-24B','24B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('183','2','XF-N-25B','25B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('184','2','XF-N-26B','26B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('185','2','XF-N-27B','27B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('186','2','XF-N-28B','28B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('187','2','XF-N-29B','29B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('188','2','XF-N-30B','30B','storage','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('189','3','JY-P-A1','A1','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('190','3','JY-P-A2','A2','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('191','3','JY-P-A3','A3','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38'),('192','3','JY-P-A4','A4','processing','0','normal','2025-08-25 17:49:38','2025-08-25 17:49:38');

DROP TABLE IF EXISTS `transaction_logs`;
CREATE TABLE `transaction_logs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) DEFAULT NULL COMMENT '操作用户ID',
  `action` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '操作类型',
  `table_name` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '操作表名',
  `record_id` int(11) DEFAULT NULL COMMENT '记录ID',
  `old_data` json DEFAULT NULL COMMENT '旧数据',
  `new_data` json DEFAULT NULL COMMENT '新数据',
  `ip_address` varchar(45) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'IP地址',
  `user_agent` text COLLATE utf8mb4_unicode_ci COMMENT '用户代理',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `user_id` (`user_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';


DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '用户名',
  `password` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '密码',
  `real_name` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '真实姓名',
  `role` enum('admin','manager','operator','viewer') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'operator',
  `base_id` int(11) DEFAULT NULL COMMENT '所属基地ID',
  `phone` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '电话',
  `email` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '邮箱',
  `last_login` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后登录时间',
  `status` tinyint(1) DEFAULT '1' COMMENT '状态：1启用，0禁用',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `base_id` (`base_id`)
) ENGINE=MyISAM AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';

INSERT INTO `users` VALUES ('1','admin','$2y$10$hNBH50jdl3CmohUBrSUI6eBg/omd8wqNTjSXOUHw3c3Z3xB6v5OWO','系统管理员','admin',NULL,NULL,NULL,'2025-08-13 11:04:56','1','2025-08-13 10:53:20','2025-08-13 11:04:56'),('2','0050016','$2y$10$PtcsNQDtHl4NwQpf09CTM.9F3bBUCXicOs5oEcbhHzfIjqJmfxbSi','刘春光','operator','1','13881030875','','2025-08-13 16:23:09','1','2025-08-13 13:32:10','2025-08-13 16:23:09'),('3','0030025','$2y$10$MhFaeVbI2V4veiOwfeJWneJoAJpgj5ydt2haf/Hvq0.KoSQG0PKxK','王明阳','manager','1','18582728595','','2025-08-19 14:53:55','1','2025-08-13 13:33:20','2025-08-19 14:53:55'),('4','0030013','$2y$10$Sau4.JoAsVlFFNdiY6KHR.bdFPbNJ0hc9FUwh3.aK/nMOqXv9lqAS','陈一靖','viewer','1','13658154114','','2025-08-19 14:57:34','1','2025-08-13 15:12:19','2025-08-19 14:57:34');

DROP VIEW IF EXISTS `daily_operation_summary`;
CREATE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `daily_operation_summary` AS select `ior`.`base_id` AS `base_id`,`b`.`name` AS `base_name`,`ior`.`operation_date` AS `operation_date`,`ior`.`operation_type` AS `operation_type`,count(0) AS `record_count`,sum(`ior`.`operation_quantity`) AS `total_quantity`,sum(`ior`.`total_area`) AS `total_area`,count(distinct `ior`.`package_id`) AS `package_count`,count(distinct `ior`.`glass_type_id`) AS `glass_type_count` from (`inventory_operation_records` `ior` left join `bases` `b` on((`ior`.`base_id` = `b`.`id`))) where (`ior`.`status` = 'completed') group by `ior`.`base_id`,`ior`.`operation_date`,`ior`.`operation_type` order by `ior`.`operation_date` desc,`ior`.`base_id`,`ior`.`operation_type`;

DROP VIEW IF EXISTS `package_operation_history`;
CREATE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `package_operation_history` AS select `ior`.`id` AS `id`,`ior`.`record_no` AS `record_no`,`ior`.`operation_type` AS `operation_type`,`ior`.`package_id` AS `package_id`,`ior`.`glass_type_id` AS `glass_type_id`,`ior`.`base_id` AS `base_id`,`ior`.`operation_quantity` AS `operation_quantity`,`ior`.`before_quantity` AS `before_quantity`,`ior`.`after_quantity` AS `after_quantity`,`ior`.`from_rack_id` AS `from_rack_id`,`ior`.`to_rack_id` AS `to_rack_id`,`ior`.`unit_area` AS `unit_area`,`ior`.`total_area` AS `total_area`,`ior`.`operator_id` AS `operator_id`,`ior`.`operation_date` AS `operation_date`,`ior`.`operation_time` AS `operation_time`,`ior`.`status` AS `status`,`ior`.`scrap_reason` AS `scrap_reason`,`ior`.`notes` AS `notes`,`ior`.`related_record_id` AS `related_record_id`,`ior`.`created_at` AS `created_at`,`ior`.`updated_at` AS `updated_at`,`gp`.`package_code` AS `package_code`,`gt`.`name` AS `glass_name`,`gt`.`thickness` AS `thickness`,`gt`.`color` AS `color`,`gt`.`brand` AS `brand`,`b`.`name` AS `base_name`,`u`.`real_name` AS `operator_name`,`fr`.`code` AS `from_rack_code`,`tr`.`code` AS `to_rack_code` from ((((((`inventory_operation_records` `ior` left join `glass_packages` `gp` on((`ior`.`package_id` = `gp`.`id`))) left join `glass_types` `gt` on((`ior`.`glass_type_id` = `gt`.`id`))) left join `bases` `b` on((`ior`.`base_id` = `b`.`id`))) left join `users` `u` on((`ior`.`operator_id` = `u`.`id`))) left join `storage_racks` `fr` on((`ior`.`from_rack_id` = `fr`.`id`))) left join `storage_racks` `tr` on((`ior`.`to_rack_id` = `tr`.`id`))) order by `ior`.`operation_date` desc,`ior`.`operation_time` desc;

SET FOREIGN_KEY_CHECKS=1;
