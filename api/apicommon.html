<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApiCommonå·¥å…·ç±»æ–‡æ¡£ - åŸç‰‡ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .nav {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .nav a {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            margin: 0 10px;
            transition: background 0.3s ease;
        }
        
        .nav a:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .section h3 {
            color: #555;
            margin: 25px 0 15px 0;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .method-info {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .method-info h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .param-table th, .param-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .param-table th {
            background: #f0f0f0;
            font-weight: bold;
        }
        
        .param-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .example {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .example h4 {
            color: #4caf50;
            margin-bottom: 10px;
        }
        
        .status-badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ApiCommonå·¥å…·ç±»æ–‡æ¡£</h1>
            <p>ç»Ÿä¸€è®¤è¯å’Œå“åº”å¤„ç†å·¥å…·ç±» - ç‰ˆæœ¬ 2.0</p>
        </div>
        
        <div class="nav">
            <a href="index.html">ğŸ  é¦–é¡µ</a>
            <a href="auth.html">ğŸ” è®¤è¯æ¥å£</a>
            <a href="packages.html">ğŸ“¦ åŒ…ä¿¡æ¯æ¥å£</a>
            <a href="racks.html">ğŸ—ï¸ åº“ä½æ¶æ¥å£</a>
            <a href="scan.html">ğŸ“± æ‰«ææ“ä½œæ¥å£</a>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>ğŸ“‹ æ¦‚è¿°</h2>
                <p><span class="status-badge">âœ… å·²å®ç°</span> ApiCommon.php æ˜¯ä¸ºåŸç‰‡ç®¡ç†ç³»ç»ŸAPIæä¾›ç»Ÿä¸€è®¤è¯å’Œå“åº”å¤„ç†çš„æ ¸å¿ƒå·¥å…·ç±»ã€‚</p>
                
                <div class="example">
                    <h4>ğŸ¯ ä¸»è¦åŠŸèƒ½</h4>
                    <ul>
                        <li><strong>ç»Ÿä¸€è®¤è¯æœºåˆ¶</strong>ï¼šæ‰€æœ‰APIä½¿ç”¨ç›¸åŒçš„è®¤è¯æµç¨‹</li>
                        <li><strong>æ ‡å‡†åŒ–å“åº”æ ¼å¼</strong>ï¼šç»Ÿä¸€çš„JSONå“åº”ç»“æ„</li>
                        <li><strong>é¢„æ£€è¯·æ±‚å¤„ç†</strong>ï¼šè‡ªåŠ¨å¤„ç†CORSé¢„æ£€è¯·æ±‚</li>
                        <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šä¸€è‡´çš„é”™è¯¯å“åº”æœºåˆ¶</li>
                        <li><strong>ä»£ç å¤ç”¨</strong>ï¼šæ¶ˆé™¤é‡å¤çš„è®¤è¯å’Œå“åº”ä»£ç </li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ”§ æ ¸å¿ƒæ–¹æ³•</h2>
                
                <div class="method-info">
                    <h4>ğŸ“¤ setHeaders() - è®¾ç½®å“åº”å¤´</h4>
                    <p><strong>åŠŸèƒ½</strong>ï¼šè®¾ç½®ç»Ÿä¸€çš„HTTPå“åº”å¤´ï¼ŒåŒ…æ‹¬CORSæ”¯æŒã€‚</p>
                    <div class="code-block">
ApiCommon::setHeaders();
                    </div>
                </div>
                
                <div class="method-info">
                    <h4>ğŸ”„ handlePreflight() - å¤„ç†é¢„æ£€è¯·æ±‚</h4>
                    <p><strong>åŠŸèƒ½</strong>ï¼šè‡ªåŠ¨å¤„ç†OPTIONSé¢„æ£€è¯·æ±‚ã€‚</p>
                    <div class="code-block">
ApiCommon::handlePreflight();
                    </div>
                </div>
                
                <div class="method-info">
                    <h4>ğŸ” authenticate() - ç»Ÿä¸€è®¤è¯</h4>
                    <p><strong>åŠŸèƒ½</strong>ï¼šéªŒè¯Bearer Tokenå¹¶è¿”å›å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚</p>
                    <div class="code-block">
$currentUser = ApiCommon::authenticate();
                    </div>
                    <p><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸè¿”å›ç”¨æˆ·ä¿¡æ¯æ•°ç»„ï¼Œå¤±è´¥è‡ªåŠ¨å‘é€401å“åº”ã€‚</p>
                </div>
                
                <div class="method-info">
                    <h4>ğŸ“¨ sendResponse() - å‘é€å“åº”</h4>
                    <p><strong>åŠŸèƒ½</strong>ï¼šå‘é€æ ‡å‡†åŒ–çš„JSONå“åº”ã€‚</p>
                    <div class="code-block">
ApiCommon::sendResponse(200, 'æ“ä½œæˆåŠŸ', $data);
                    </div>
                    <table class="param-table">
                        <tr>
                            <th>å‚æ•°</th>
                            <th>ç±»å‹</th>
                            <th>è¯´æ˜</th>
                        </tr>
                        <tr>
                            <td>code</td>
                            <td>int</td>
                            <td>HTTPçŠ¶æ€ç </td>
                        </tr>
                        <tr>
                            <td>message</td>
                            <td>string</td>
                            <td>å“åº”æ¶ˆæ¯</td>
                        </tr>
                        <tr>
                            <td>data</td>
                            <td>mixed</td>
                            <td>å“åº”æ•°æ®ï¼ˆå¯é€‰ï¼‰</td>
                        </tr>
                    </table>
                </div>
                
                <div class="method-info">
                    <h4>ğŸ” getBearerToken() - è·å–Token</h4>
                    <p><strong>åŠŸèƒ½</strong>ï¼šä»è¯·æ±‚å¤´ä¸­æå–Bearer Tokenã€‚</p>
                    <div class="code-block">
$token = ApiCommon::getBearerToken();
                    </div>
                </div>
                
                <div class="method-info">
                    <h4>âœ… validateApiToken() - éªŒè¯Token</h4>
                    <p><strong>åŠŸèƒ½</strong>ï¼šéªŒè¯Tokençš„æœ‰æ•ˆæ€§ã€‚</p>
                    <div class="code-block">
$isValid = ApiCommon::validateApiToken($token);
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸš€ ä½¿ç”¨ç¤ºä¾‹</h2>
                
                <div class="example">
                    <h4>ğŸ“ å®Œæ•´çš„APIå®ç°ç¤ºä¾‹</h4>
                    <div class="code-block">
<?php
require_once '../config/config.php';
require_once '../includes/db.php';
require_once '../includes/functions.php';
require_once 'ApiCommon.php';

// è®¾ç½®å“åº”å¤´å’Œå¤„ç†é¢„æ£€è¯·æ±‚
ApiCommon::setHeaders();
ApiCommon::handlePreflight();

// éªŒè¯Tokenè®¤è¯
$currentUser = ApiCommon::authenticate();

// å¤„ç†ä¸šåŠ¡é€»è¾‘
try {
    // ä¸šåŠ¡ä»£ç ...
    $data = ['result' => 'success'];
    
    // å‘é€æˆåŠŸå“åº”
    ApiCommon::sendResponse(200, 'æ“ä½œæˆåŠŸ', $data);
    
} catch (Exception $e) {
    // å‘é€é”™è¯¯å“åº”
    ApiCommon::sendResponse(500, 'æœåŠ¡å™¨é”™è¯¯: ' . $e->getMessage());
}
?>
                    </div>
                </div>
                
                <div class="example">
                    <h4>ğŸ“Š å“åº”æ ¼å¼ç¤ºä¾‹</h4>
                    <div class="code-block">
{
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "timestamp": 1698765432,
    "data": {
        "id": 1,
        "name": "ç¤ºä¾‹æ•°æ®"
    }
}
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ¯ ä¼˜åŒ–æ•ˆæœ</h2>
                
                <div class="example">
                    <h4>âœ… å·²å®Œæˆä¼˜åŒ–</h4>
                    <ul>
                        <li><strong>ä»£ç å†—ä½™æ¶ˆé™¤</strong>ï¼šç§»é™¤äº†é‡å¤çš„è®¤è¯å’Œå“åº”å‡½æ•°</li>
                        <li><strong>ç»´æŠ¤æ€§æå‡</strong>ï¼šç»Ÿä¸€çš„è®¤è¯æœºåˆ¶ä¾¿äºåç»­ç»´æŠ¤</li>
                        <li><strong>å®‰å…¨æ€§å¢å¼º</strong>ï¼šä¸€è‡´çš„è®¤è¯æµç¨‹</li>
                        <li><strong>ä½¿ç”¨ç®€åŒ–</strong>ï¼šAPIè°ƒç”¨æ›´åŠ ç®€æ´æ˜äº†</li>
                    </ul>
                </div>
                
                <div class="example">
                    <h4>ğŸ“ˆ æ€§èƒ½æå‡</h4>
                    <ul>
                        <li>å‡å°‘ä»£ç é‡å¤ï¼Œæé«˜å¼€å‘æ•ˆç‡</li>
                        <li>ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥</li>
                        <li>æ ‡å‡†åŒ–å“åº”æ ¼å¼ï¼Œä¾¿äºå‰ç«¯å¤„ç†</li>
                        <li>ç®€åŒ–è®¤è¯æµç¨‹ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2024 åŸç‰‡ç®¡ç†ç³»ç»Ÿ APIæ–‡æ¡£ | ApiCommonå·¥å…·ç±» | ç‰ˆæœ¬ 2.0 | æœ€åæ›´æ–°: 2025-11-01</p>
        </div>
    </div>
</body>
</html>